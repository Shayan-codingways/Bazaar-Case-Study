

select * 
from dbo.[dataset 1]

select * 
from dbo.[dataset 2]

-- Total number of orders 
select count(distinct order_number)
from dbo.[dataset 2]

-- Total sales revenue 
select * 
from dbo.[dataset 2]


select ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]


select round(sum(revenue_on_items),2) as Total_Revenue  
from (select ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]) as b


-- Average order value 

select order_number, ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]

select order_number, sum(revenue_on_items) as order_revenue
from (select order_number, ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]) as b
group by order_number

Select round(avg(order_revenue),2) as average_order_value
from (select sum(revenue_on_items) as order_revenue
from (select order_number, ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]) as b
group by order_number) as d

-- Distribution of orders by warehouse and store 
select * 
from dbo.[dataset 2]

Select order_warehouse_id, store_id, count(distinct order_number) as orders
from dbo.[dataset 2]
group by order_warehouse_id, store_id
order by orders desc

-- Top 5 selling items 
select * 
from dbo.[dataset 2]

-- checking whether every item have same item_id in rows below
select item_name, item_id
from [dataset 2]
where item_name = 'Peek Freans Chocolate Sandwich Biscuits Rs. 20 Box (16 Packs)'

select top 5 item_name, count(item_name) as count
from [dataset 2]
group by item_name
order by count desc


-- How many users signed up through paid channels?

select * 
from dbo.[dataset 1]

select * 
from dbo.[dataset 2]

select acquisition_platform, count(store_id) as count
from [dataset 1]
where acquisition_platform != 'Organic' And acquisition_platform is NOT Null
group by acquisition_platform
order by count desc

select sum(count) as total_users_paid 
from (select acquisition_platform, count(store_id) as count
       from [dataset 1]
       where acquisition_platform != 'Organic' And acquisition_platform is NOT Null
       group by acquisition_platform) as e

-- What % of users placed at least one order? 
select * 
from dbo.[dataset 1]

select cast(count(first_order_date) as float) as atleast1order, count(store_id) as total
from [dataset 1]

Select round( (cast(atleast1order as float)*100/total ),2) as user_percent
from (select count(first_order_date) as atleast1order, count(store_id) as total
      from [dataset 1]) as b


-- From which channel are most of the users acquired? 
select * 
from dbo.[dataset 1]

select top 1 acquisition_platform, count(store_id) as count
from [dataset 1]
group by acquisition_platform
order by count desc

-- What % of orders were canceled? 

-- What % of orders were canceled?

-- Way 1
SELECT 
    (COUNT(DISTINCT CASE WHEN  order_status = 'CANCELLED' THEN order_number END) * 100.0) / 
    COUNT(DISTINCT order_number) AS CANCELLED_PERCENTAGE
FROM [dataset 2]

-- Way 2
select order_number, order_status
from [dataset 2]
group by order_number,order_status

select count(order_status)  
from (
select order_number, order_status
from [dataset 2]
group by order_number,order_status) as a
where order_status = 'Cancelled'

select count(order_status)
from (
select order_number, order_status
from [dataset 2]
group by order_number,order_status) as b





select (cancelled * 100.0/total) as Cancelled_percent
from (
    SELECT 
       (select count(order_status)
        from (
                select order_number, order_status
                from [dataset 2]
                group by order_number,order_status) as g
                where order_status = 'Cancelled') AS cancelled,
     
        (select count(order_status) as count
         from (
                select order_number, order_status
                from [dataset 2]
                group by order_number,order_status) AS total_counts) AS total
    ) as f


-- ?	What is the total sales generated by the store channel? 

select store_channel, ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]

select store_channel, round(sum(revenue_on_items),2) as revenue
from (select store_channel, ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]) as b
group by store_channel



--------------------------------------------------------------------------------------------------------------


--  most sold items by company
select distinct_item, round(sum(revenue_on_items),2) as revenue
from (select distinct_item, ((amount_per_unit * ordered_quantity) - ( item_discount )) as revenue_on_items
from dbo.[dataset 2]) as b
group by distinct_item
order by revenue desc
















select *
from [dataset 1] as a
outer join [dataset 2] as b
on a.store_id = b.store_id

select order_date ,order_number,(ordered_quantity * amount_per_unit) - item_discount as sales
from [dataset 2]

select order_date, sum (sales) as daily_sales, count(distinct order_number) as orders
from (
select order_date ,order_number, (ordered_quantity * amount_per_unit) - item_discount as sales
from [dataset 2]) as b
group by order_date


